<div id="audio"></div>
<button id="start">Start</button>
<button id="stop">Stop</button>
<script>
    const URL = 'voice.php';
    navigator.mediaDevices.getUserMedia({ audio: true})
        .then(stream => {
        const mediaRecorder = new MediaRecorder(stream);

        document.querySelector('#start').addEventListener('click', function(){
            mediaRecorder.start();
        });
        let audioChunks = [];
        mediaRecorder.addEventListener("dataavailable",function(event) {
            audioChunks.push(event.data);
        });

        document.querySelector('#stop').addEventListener('click', function(){
            mediaRecorder.stop();
        });

        mediaRecorder.addEventListener("stop", function() {
                const audioBlob = new Blob(audioChunks, {
                type: 'audio/wav'
            });

            let fd = new FormData();
            fd.append('voice', audioBlob);
            sendVoice(fd);
            audioChunks = [];
        });
    });

    async function sendVoice(form) {
        let promise = await fetch(URL, {
            method: 'POST',
            body: form});
        if (promise.ok) {
            let response =  await promise.json();
            console.log(response.data);
            let audio = document.createElement('audio');
            audio.src = response.data;
            audio.controls = true;
            audio.autoplay = true;
            document.querySelector('#audio').appendChild(audio);
        }
    }
</script>